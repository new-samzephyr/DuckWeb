<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Topic Quiz</title>
    <style>
        #definition-modal, #overlay {
            display: none;
            position: fixed;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
        }
        #definition-content {
            background: white;
            padding: 20px;
            border-radius: 5px;
        }
        #definition-text {
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <h1>Topic Quiz</h1>
    <div id="timer">Time Left: <span id="selected-time">30</span> seconds</div>
    <button id="start-pause">Pause</button>
    <button id="skip-topic">Skip</button>
    <button id="answer-topic">Answer</button>
    <div id="time-selector-container">
        <label for="time-selector">Set Time:</label>
        <input type="range" id="time-selector" min="10" max="120" step="10" value="30">
    </div>
    <div id="definition-modal">
        <div id="definition-content">
            <p id="definition-text"></p>
            <button onclick="closeDefinition()">Close</button>
        </div>
    </div>
    <div id="overlay"></div>

    <script>
        let topics = [];
        let currentTopicIndex = 0;
        let isPaused = false;
        let timeLeft = 30;
        let difficultyLevels = ['A1', 'A2', 'B1', 'B2', 'C1', 'C2'];
        let completedTopics = {
            'A1': 0, 'A2': 0, 'B1': 0, 'B2': 0, 'C1': 0, 'C2': 0
        };
        let skippedTopics = [];
        let playerLevel = 'A1'; // Starting difficulty level

        // Load topics from JSON
        fetch('topics.json')
            .then(response => response.json())
            .then(data => {
                for (const level of difficultyLevels) {
                    topics = topics.concat(data[level].map(topic => ({ ...topic, difficulty: level })));
                }
                startQuiz();
            });

        function startQuiz() {
            changeTopic();
            document.getElementById('time-selector').addEventListener('input', updateTime);
            document.getElementById('start-pause').addEventListener('click', togglePause);
            document.getElementById('skip-topic').addEventListener('click', skipTopic);
            document.getElementById('answer-topic').addEventListener('click', answerTopic);
            updateTime();
            startTimer();
        }

        function startTimer() {
            setInterval(() => {
                if (!isPaused && timeLeft > 0) {
                    timeLeft--;
                    document.getElementById('timer').innerText = `Time Left: ${timeLeft} seconds`;
                }
            }, 1000);
        }

        function changeTopic() {
            if (topics.length === 0) return;

            // Filter topics based on current difficulty and completed topics
            let availableTopics = getAvailableTopics(playerLevel);

            if (availableTopics.length === 0) {
                alert('No more topics available at this level.');
                return;
            }

            currentTopicIndex = Math.floor(Math.random() * availableTopics.length);
            document.getElementById('timer').innerText = `Time Left: ${timeLeft} seconds`;

            showTopic(availableTopics[currentTopicIndex]);
        }

        function showTopic(topic) {
            document.body.innerHTML += `<h2>${topic.topic}</h2>`;
            document.body.innerHTML += `<button onclick="showDefinition()">Show Definition</button>`;
        }

        function getAvailableTopics(currentLevel) {
            let levelIndex = difficultyLevels.indexOf(currentLevel);
            let currentGroup = difficultyLevels.slice(0, levelIndex + 1);
            let availableTopics = [];

            for (const level of currentGroup) {
                availableTopics = availableTopics.concat(topics.filter(t => t.difficulty === level));
            }

            return availableTopics.filter(t => completedTopics[t.difficulty] < 5); // Example: show topics not completed 5 times
        }

        function updateTime() {
            const timeSelector = document.getElementById('time-selector');
            timeLeft = parseInt(timeSelector.value); // Update timeLeft based on slider
            document.getElementById('selected-time').innerText = timeLeft; // Update display
        }

        function togglePause() {
            isPaused = !isPaused;
            document.getElementById('start-pause').innerText = isPaused ? 'Continue' : 'Pause';
        }

        function showDefinition() {
            isPaused = true;
            document.getElementById('definition-text').innerText = topics[currentTopicIndex].definition;
            document.getElementById('definition-modal').style.display = 'block';
            document.getElementById('overlay').style.display = 'block';
            document.getElementById('start-pause').innerText = 'Continue'; // Ensure correct button text
        }

        function closeDefinition() {
            isPaused = false;
            document.getElementById('definition-modal').style.display = 'none';
            document.getElementById('overlay').style.display = 'none';
            document.getElementById('start-pause').innerText = 'Pause'; // Ensure correct button text
        }

        function skipTopic() {
            const skippedTopic = topics[currentTopicIndex];
            skippedTopics.push(skippedTopic);
            changeTopic(); // Change to a new topic
            timeLeft = parseInt(document.getElementById('time-selector').value); // Reset timer
            document.getElementById('timer').innerText = `Time Left: ${timeLeft} seconds`;
        }

        function answerTopic() {
            // Called when a topic is correctly answered
            const currentTopic = topics[currentTopicIndex];
            completedTopics[currentTopic.difficulty] = (completedTopics[currentTopic.difficulty] || 0) + 1;
            changeTopic(); // Change to a new topic
            timeLeft = parseInt(document.getElementById('time-selector').value); // Reset timer
            document.getElementById('timer').innerText = `Time Left: ${timeLeft} seconds`;
        }
    </script>
</body>
</html>
